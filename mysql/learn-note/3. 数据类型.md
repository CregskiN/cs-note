# 3. 数据类型

[TOC]



## 3.1 数值类型

### 3.1.1 整型

|           类型           | 占用的存储空间（单位：字节） | 无符号数取值范围 | 有符号数取值范围 |      含义      |
| :----------------------: | :--------------------------: | :--------------: | :--------------: | :------------: |
|        `TINYINT`         |              1               |     0 ~ 2⁸-1     |    -2⁷ ~ 2⁷-1    |  非常小的整数  |
|        `SMALLINT`        |              2               |    0 ~ 2¹⁶-1     |   -2¹⁵ ~ 2¹⁵-1   |    小的整数    |
|       `MEDIUMINT`        |              3               |    0 ~ 2²⁴-1     |   -2²³ ~ 2²³-1   | 中等大小的整数 |
| `INT`（别名：`INTEGER`） |              4               |    0 ~ 2³²-1     |   -2³¹ ~ 2³¹-1   |   标准的整数   |
|         `BIGINT`         |              8               |    0 ~ 2⁶⁴-1     |   -2⁶³ ~ 2⁶³-1   |     大整数     |



### 3.1.2 浮点型

|   类型   | 占用的存储空间（单位：字节） |     绝对值最小非0值      |     绝对值最大非0值      |     含义     |
| :------: | :--------------------------: | :----------------------: | :----------------------: | :----------: |
| `FLOAT`  |              4               |     ±1.175494351E-38     |     ±3.402823466E+38     | 单精度浮点数 |
| `DOUBLE` |              8               | ±2.2250738585072014E-308 | ±1.7976931348623157E+308 | 双精度浮点数 |

<img src="https://www.qiniu.cregskin.com/image-20201020152649308.png" alt="image-20201020152649308" style="zoom: 50%;" />

>  浮点数表示小数位，往往是不精确的



#### 设置最大位数和最小位数

```sql
FLOAT(M, D)
DOUBLE(M, D)
```

+ M 表示该小数最多需要的十进制有效数字个数

  M 取值范围 1~255

  如 `-2.3` 有效数字个数是 `2`，`0.9` 有效数字个数是 `1`

+ D 该小数的小数点后的十进制数字个数

  D 取值范围 0~30 && D < M

> `M`和`D`都是可选的，如果我们省略了它们，那它们的值按照机器支持的最大值来存储。

|     类型      |     取值范围     |
| :-----------: | :--------------: |
| `FLOAT(4, 1)` |   -999.9~999.9   |
| `FLOAT(5, 1)` |  -9999.9~9999.9  |
| `FLOAT(6, 1)` | -99999.9~99999.9 |
| `FLOAT(4, 0)` |    -9999~9999    |
| `FLOAT(4, 1)` |   -999.9~999.9   |
| `FLOAT(4, 2)` |   -99.99~99.99   |



### 3.1.3 定点数类型

|      类型       | 占用的存储空间（单位：字节） |  取值范围  |
| :-------------: | :--------------------------: | :--------: |
| `DECIMAL(M, D)` |          取决于M和D          | 取决于M和D |

+ M 默认为 10
+ D 默认为 0

9 个十进制位为一组

| 组中包含的十进制位数 | 占用存储空间大小（单位：字节） |
| :------------------: | :----------------------------: |
|         1或2         |               1                |
|         3或4         |               2                |
|         5或6         |               3                |
|       7或8或9        |               4                |



### 3.1.4 无符号数值类型的表示

```sql
数值类型 UNSIGNED
如
INT UNSIGNED 无符号整型
FLOAT UNSIGNED 无符号浮点型
DECIMAL UNSIGNED 无符号定点数
```

> 小贴士： 
>
> 在使用的存储空间大小相同的情况下，无符号整数可以表示的正整数范围比有符号整数能表示的正整数范围大一倍。不过受浮点数和定点数具体的存储格式影响，无符号浮点数和定点数并不能提升正数的表示范围





## 3.2 日期和时间类型

mysql 5.6.4 之前

|    类型     | 存储空间要求 |                    取值范围                    |     含义     |
| :---------: | :----------: | :--------------------------------------------: | :----------: |
|   `YEAR`    |    1字节     |                   1901~2155                    |    年份值    |
|   `DATE`    |    3字节     |          '1000-01-01' ~ '9999-12-31'           |    日期值    |
|   `TIME`    |    3字节     |           '-838:59:59' ~ '838:59:59'           |    时间值    |
| `DATETIME`  |    8字节     | '1000-01-01 00:00:00' ～ '9999-12-31 23:59:59' | 日期加时间值 |
| `TIMESTAMP` |    4字节     | '1970-01-01 00:00:01' ～ '2038-01-19 03:14:07' |    时间戳    |

mysql 5.6.4之后

|    类型     |      存储空间要求      |                           取值范围                           |     含义     |
| :---------: | :--------------------: | :----------------------------------------------------------: | :----------: |
|   `YEAR`    |         1字节          |                          1901~2155                           |    年份值    |
|   `DATE`    |         3字节          |                 '1000-01-01' ~ '9999-12-31'                  |    日期值    |
|   `TIME`    | 3字节+小数秒的存储空间 |         '-838:59:59[.000000]' ~ '838:59:59[.000000]'         |    时间值    |
| `DATETIME`  | 5字节+小数秒的存储空间 | '1000-01-01 00:00:00[.000000]' ～ '9999-12-31 23:59:59'[.999999] | 日期加时间值 |
| `TIMESTAMP` | 4字节+小数秒的存储空间 | '1970-01-01 00:00:01[.000000]' ～ '2038-01-19 03:14:07'[.999999] |    时间戳    |

在`MySQL5.6.4`这个版本之后，`TIME`、`DATETIME`、`TIMESTAMP`这几种类型添加了对毫秒、微秒的支持。由于毫秒、微秒都不到1秒，所以也被称为`小数秒`，`MySQL`最多支持6位小数秒的精度，各个位代表的意思如下：

<img src="https://www.qiniu.cregskin.com/image-20201020160312228.png" alt="image-20201020160312228" style="zoom: 33%;" />



```sql
类型(小数秒位数)
```

+ 类型 `TIME`、`DATETIME`、`TIMESTAMP`
+ 小数秒位数 可选 0 1 2 3 4 5 6

```sql
DATETIME(0) 精确到秒
DATETIME(3) 精确到毫秒
DATETIME(5) 精确到10ms
```

存储空间如下：

| 保留的小数秒位数 | 额外需要的存储空间要 |
| :--------------: | :------------------: |
|        0         |        0字节         |
|       1或2       |        1字节         |
|       3或4       |        2字节         |
|       5或6       |        3字节         |

即

+ DATETIME(3) 占用空间是在 8byte + 2byte
+ DATETIME(5) = 8byte + 2byte



### YEAR

```sql
YEAR
or 也可以写成
YEAR(4)
```

+ 取值范围 1901 ~ 2155
+ 空间 1 byte

> YEAR 表示范围有限，如需要更大 `SMALLINT`(2byte) 或字符串类型都可以



### DATE TIME DATETIME

+ DAET 日期，格式 YYYY-MM-DD
+ TIME 时间，格式 hh:mm:ss[.uuuuuu] 或者 hhh:mm:ss[.uuuuuu]\(有时候存储的小时是三位数)
+ DATETIME 时间+日期，格式 YYYY-MM-DD hh:mm:ss[.uuuuuu]

> DATETIME 中 TIME 部分表示的是一天的时间（00:00:00 ~ 23:59:59）
>
> 而 TIME 表示的是一段时间，可以是负值



### TIMESTAMP

时间戳：把某个时刻距离`1970-01-01 00:00:00`的秒数称为`时间戳`

比方说当前时间是`2018-01-24 11:39:21`，距离`1970-01-01 00:00:00`的秒数为`1516765161`，那么`2018-01-24 11:39:21`这个时刻的时间戳就是`1516765161`

不过在`MySQL5.6.4`之后，时间戳的值也可以加入小数秒。

> 用时间戳存储时间的好处就是，它展示的值可以随着时区的变化而变化。



## 3.3 字符串类型

### 3.3.1 字符和字符串

+ 字符

  + 可见字符

    可打印字符

  + 不可见字符

    不可见，仅控制输出效果的字符。如换行用的制表符，或打印时“嘟”一声

+ 字符串

  把字符连起来



### 3.3.2 字符编码

#### 1. 固定长度的编码方案

即**存储不同字符，需要的字节数量时相同的**

| 编码方案 | 占用空间    |
| -------- | ----------- |
| ASCII    | 1 byte/字符 |
| ucs2     | 2 byte/字符 |



#### 2. 变长度的编码方案

即**存储不同字符，需要的字节数量是不同的**

| 编码方案 | 占用空间      |
| -------- | ------------- |
| utf8     | 1~3 byte/字符 |
| gb2312   | 1~2 byte/字符 |

> MySql 中 utf8 是阉割版 ，utf8mb4 才是正统的 utf8

> mysql 中对 `字符集`和`编码方案`没区分

> 小贴士： 
>
> 正宗的utf8字符集是使用1~4个字节来编码一个字符的，不过MySQL中对utf8字符集做了阉割，编码一个字符最多使用3个字节。如果我们之后有存储使用4个字节来编码的字符的情景，可以使用一种称之为utf8mb4的字符集，它才是正宗的utf8字符集。



#### 3. MySql 的字符串类型

|     类型     |   最大长度   |   存储空间要求    |       含义       |
| :----------: | :----------: | :---------------: | :--------------: |
|  `CHAR(M)`   |   M个字符    |     M×W个字节     | 固定长度的字符串 |
| `VARCHAR(M)` |   M个字符    | L+1 或 L+2 个字节 | 可变长度的字符串 |
|  `TINYTEXT`  | 2⁸-1 个字节  |     L+1个字节     | 非常小型的字符串 |
|    `TEXT`    | 2¹⁶-1 个字节 |    L+2 个字节     |   小型的字符串   |
| `MEDIUMTEXT` | 2²⁴-1 个字节 |     L+3个字节     | 中等大小的字符串 |
|  `LONGTEXT`  | 2³²-1 个字节 |     L+4个字节     |   大型的字符串   |

+ `M` 代表该数据类型最多能存储的字符数量
+ `L` 代表我们实际向该类型的属性中存储的字符串在特定字符集下所占的字节数
+ `W` 代表在该特定字符集下，编码一个字符最多需要的字节数



##### CHAR(M)

+ M 取值范围 0~255，默认是 1，即 `CHAR`等价于`CHAR(1)`
+ CHAR(0) 是一种特别类型，只能存储 \`` 或 NULL

+ CHAR(M) 在不同字符集下存储空间不同
  + 对于采用`ascii`字符集的`CHAR(5)`类型来说，`ascii`字符集编码一个字符最多需要1个字节，也就是`M=5`、`W=1`，所以这种情况下该类型占用的存储空间大小就是`5×1 = 5`个字节
  + 对于采用`gbk`字符集的`CHAR(5)`类型来说，`gbk`字符集编码一个字符最多需要2个字节，也就是`M=5`、`W=2`，所以这种情况下该类型占用的存储空间大小就是`5×2 = 10`个字节
  + 对于采用`utf8`字符集的`CHAR(5)`类型来说，`utf8`字符集编码一个字符最多需要3个字节，也就是`M=5`、`W=3`，所以这种情况下该类型占用的存储空间大小就是`5×3 = 15`个字节

> 小贴士：
>
>  字符'a'在ascii字符集下被编码为0x61，
>
> 字符'b'在ascii字符集下被编码为0x62，
>
> 字符'c'在ascii字符集下被编码为0x63，
>
> 空格字符被编码为0x20，
>
> 所以将字符串'abc'存入采用ascii字符集的CHAR(5)类型的表属性中时，实际存储的字节序列就是：0x6162632020。



##### VARCHAR(M)

+ 目的：为了解决定长的 CHAR(M) 可能造成空间浪费的问题
+ M 取值范围 1~65535，遵循 MySql 规定 `表中某一行包含的所有列中存储的数据大小总共不得超过65535个字节（注意是字节）`，也就是说`VARCHAR(M)`类型实际能够容纳的字符数量是小于65535的

+ `VARCHAR(M)`类型占用的存储空间不确定

`VARCHAR(M)`类型占用的存储空间不确定，系统在读一个`VARCHAR(M)`类型的数据时怎么知道该数据占用多少个字节呢？所以一个`VARCHAR(M)`类型表示的数据其实是由这么两部分组成：

> 第二部分专门负责记录 VARCHAR 占用的字节数

1. 真正的字符串内容

   假设真正的字符串在特定字符集编码后占用的字节数为`L`。

2. 占用字节数

   假设`VARCHAR(M)`类型采用的字符集编码一个字符最多需要`W`个字节，那么：

   + 当`M×W < 256`时，只需要一个字节来表示占用的字节数
   + 当`M×W >= 256`且`M×W < 65536`时，需要两个字节来表示占用的字节数

> 小贴士： 
>
> 一个字节占用8个 bit，能表示的最大无符号数就是255
>
> 两个字节占用16个 bit，能表示的最大无符号数就是65535



🌰：

假设我们给姓名列定义的类型为采用`utf8`字符集的`VARCHAR(5)`，也就是说`M = 5`、`W = 3`，所以`M × W= 5×3 = 15`，而`15 < 256`，所以我们只需要一个字节来表示真实数据占用的字节长度

```sql
'杜子腾'：0xE69D9CE5AD90E885BE （共9个字节）
'范统'：0xE88C83E7BB9F （共6个字节）
```

![image-20201021092348205](https://www.qiniu.cregskin.com/image-20201021092348205.png)



##### 各种类型的 TEXT

| TEXT类型   | 存储内容字节数 | 表示内容长度部分字节数 |
| ---------- | -------------- | ---------------------- |
| TINYTEXT   | 2⁸-1           | 1 byte                 |
| TEXT       | 2¹⁶-1          | 2 byte                 |
| MEDIUMTEXT | 2²⁴-1          | 3 byte                 |
| LONGTEXT   | 2³²-1          | 4 byte                 |

> MySql 对于每行所有列中数据大小总和不超过 65536byte 的限制，不适用于各种 Text 类型



##### ENUM 和 SET

ENUM(p1, p2, p3...) 枚举，在多个 p 中选一个

SET(p1, p2, p3 ...) 集合，在多个 p 中选多个





## 3.4 二进制类型

### BIT

|   类型   |    字节数     |       含义        |
| :------: | :-----------: | :---------------: |
| `BIT(M)` | 近似为(M+7)/8 | 存储M个比特位的值 |

+ M `比特位的数量`。取值范围 1~64，默认值 1
+ M < 8 ，MySql 也会申请一个字节保存信息
  + `BIT(1)`类型仅仅需要存储1个比特位的数据，但是`MySQL`会为其申请`(1+7)/8 = 1`个字节。
  + `BIT(5)`类型仅仅需要存储5个比特位的数据，但是`MySQL`会为其申请`(5+7)/8 = 1`个字节。
  + `BIT(9)`类型仅仅需要存储9个比特位的数据，但是`MySQL`会为其申请`(9+7)/8 = 2`个字节。



### BINARY(M) 和 VARBINARY(M)

前者固定长度，后者变长度

+ M 代表该类型最多存放的`字节数量`

  相较之下，CHAR(M)、VARCHAR(M) 的 M 代表最多能存放的`字符数量`



### 其他的二进制类型

`TINYBLOB`、`BLOB`、`MEDIUMBLOB`、`LONGBLOB` 针对数据量很大的二进制数据，如图片、音频、压缩文件

它们很像`TINYTEXT`、`TEXT`、`MEDIUMTEXT`、`LONGTEXT`，不过各种`BLOB`类型是用来存储字节的，而各种`TEXT`类型是用来存储字符的而已

> 小贴士： 
>
> 对于比较大的二进制数据，比方说图片、音频、压缩文件什么的，通常情况下都不直接存储到数据库管理系统中，而是将它们保存到文件系统中，然后在数据库中之存放一个文件路径即可



> 小贴士：
>
>  MySQL其实可以大致被分为server层和存储引擎层，
>
> server层用来做一些通用的逻辑，
>
> 存储引擎层负责具体的数据读取和存储，针对不同的使用场景设计了许多种不同的存储引擎。
>
> 各种数据类型在server层的格式是一致的，本文对各种数据类型占用存储空间的分析也是基于server层的，
>
> 不同的存储引擎针对不同的数据类型可能有其特定的实现，