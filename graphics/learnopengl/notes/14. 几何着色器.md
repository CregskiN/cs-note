# 几何着色器 Geometry Shader

<img src="http://127.0.0.1:8000/img/01/04/pipeline.png" alt="img" style="zoom:100%;" />

```glsl
#version 330 core
layout (points) in;
layout (line_strip, max_vertices = 2) out;

void main() {    
    gl_Position = gl_in[0].gl_Position + vec4(-0.1, 0.0, 0.0, 0.0); 
    EmitVertex();

    gl_Position = gl_in[0].gl_Position + vec4( 0.1, 0.0, 0.0, 0.0);
    EmitVertex();

    EndPrimitive();
}
```

1. ```glsl
   // geometry shader 接收的图元类型
   layout (points) in;
   ```

   声明从 Vertex Shader 接收的图元，可选：

   - `points`：绘制GL_POINTS图元时（1）。
   - `lines`：绘制GL_LINES或GL_LINE_STRIP时（2）
   - `lines_adjacency`：GL_LINES_ADJACENCY或GL_LINE_STRIP_ADJACENCY（4）
   - `triangles`：GL_TRIANGLES、GL_TRIANGLE_STRIP或GL_TRIANGLE_FAN（3）
   - `triangles_adjacency`：GL_TRIANGLES_ADJACENCY或GL_TRIANGLE_STRIP_ADJACENCY（6）

   > 括号表示，一个图元的最少顶点

2. ```glsl
   // 定义输出的图元类型、最大顶点数量（即最多用多少个点，绘制这个图元）
   layout (line_strip, max_vertices = 2) out;
   ```

   - `points`
   - `line_strip` 线条
   - `triangle_strip` 三角形

3. ```glsl
   // 获取 vertex shader 处理结果的 interface block
   in gl_Vertex
   {
       vec4  gl_Position;
       float gl_PointSize;
       float gl_ClipDistance[];
   } gl_in[];
   ```

   > 这是一个 build-in 变量，是一个数组，因为一个图元包括多个顶点

4. ```glsl
   void main() {
       gl_Position = gl_in[0].gl_Position + vec4(-0.1, 0.0, 0.0, 0.0); 
       EmitVertex();
   
       gl_Position = gl_in[0].gl_Position + vec4( 0.1, 0.0, 0.0, 0.0);
       EmitVertex();
   
       EndPrimitive();
   }
   ```

   + `EmitVertex()` 发射一个顶点，调用次数与 `max_vertices` 设置的值有关
   + `EmitPrimitive()` 将已经 emit 的顶点，合成指定的图元。可多次调用，生成多个图元

5. 





















